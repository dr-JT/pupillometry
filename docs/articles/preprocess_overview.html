<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Preprocessing Code (Template) • pupillometry</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Preprocessing Code (Template)">
<meta property="og:description" content="pupillometry">
<meta property="og:image" content="https://dr-jt.github.io/pupillometry/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pupillometry</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.7.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/preprocess_overview.html">Preprocessing Code (Template)</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Detailed Articles</li>
    <li>
      <a href="../articles/setup_pupil.html">Import and Setup</a>
    </li>
    <li>
      <a href="../articles/import_pupil.html">Import Options</a>
    </li>
    <li>
      <a href="../articles/remove_unlikely.html">Remove Unlikely Values</a>
    </li>
    <li>
      <a href="../articles/preprocess_pupil.html">Preprocessing</a>
    </li>
    <li>
      <a href="../articles/preprocessing_options.html">Preprocessing Options</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/dr-JT/pupillometry/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="preprocess_overview_files/header-attrs-2.8/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Preprocessing Code (Template)</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dr-JT/pupillometry/blob/master/vignettes/preprocess_overview.Rmd"><code>vignettes/preprocess_overview.Rmd</code></a></small>
      <div class="hidden name"><code>preprocess_overview.Rmd</code></div>

    </div>

    
    
<p>This is a short overview on how to perform preprocessing on pupil data by building a sequence of functions using the pipe <code><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></code> operator.</p>
<p>For more detailed instructions on each of the steps, see the detailed articles.</p>
<p>The recommended preprocessing steps and their order of operation varies among researchers. In general, the following preprocessing workflow and steps are recommended based on Geller et al. (2020), Kret and Sjak-Shie (2019), and Mathôt et al. (2018).</p>
<ol style="list-style-type: decimal">
<li>
<p>Import and setup for preprocessing</p>
<ul>
<li><p><strong>Read</strong> in raw data file. <code><a href="../reference/pupil_read.html">pupil_read()</a></code></p></li>
<li><p><strong>Set Time</strong> variable relative to stimulus onset. <code><a href="../reference/set_timing.html">set_timing()</a></code></p></li>
</ul>
</li>
<li>
<p>Remove unlikely pupil values</p>
<ul>
<li><p><strong>Deblink</strong> pupil data. <code><a href="../reference/pupil_deblink.html">pupil_deblink()</a></code></p></li>
<li><p><strong>Artifiact</strong> rejection. <code><a href="../reference/pupil_artifact.html">pupil_artifact()</a></code></p></li>
<li><p><strong>Remove</strong> trials with large amounts of missing data. <code><a href="../reference/pupil_missing.html">pupil_missing()</a></code></p></li>
</ul>
</li>
<li>
<p>Preprocess pupil data</p>
<ul>
<li><p><strong>Upasmple</strong> pupil data to 1000Hz. <code><a href="../reference/pupil_upsample.html">pupil_upsample()</a></code></p></li>
<li><p><strong>Smooth</strong> pupil data. <code><a href="../reference/pupil_smooth.html">pupil_smooth()</a></code></p></li>
<li><p><strong>Interpolate</strong> pupil data. <code><a href="../reference/pupil_interpolate.html">pupil_interpolate()</a></code></p></li>
<li><p><strong>Baseline Correct</strong> pupil data. <code><a href="../reference/pupil_baselinecorrect.html">pupil_baselinecorrect()</a></code></p></li>
</ul>
</li>
<li>
<p>Remove unlikely pupil values</p>
<ul>
<li><p><strong>Artifact</strong> rejection. <code><a href="../reference/pupil_artifact.html">pupil_artifact()</a></code></p></li>
<li><p><strong>Remove</strong> trials with still too much missing data. <code><a href="../reference/pupil_missing.html">pupil_missing()</a></code></p></li>
</ul>
</li>
<li>
<p>Reduce Data</p>
<ul>
<li>
<strong>Bin</strong> pupil data (down-sample) into time bins. <code><a href="../reference/pupil_bin.html">pupil_bin()</a></code>
</li>
</ul>
</li>
</ol>
<p>These function will perform preprocessing on one data file at a time. You will need to perform preprocessing on an entire list of data files contained in a folder somewhere. The easiest way to implement this is to wrap these functions in a <strong>for loop</strong> around each of the files in the folder with the raw data files.</p>
<p>You can copy and paste this code and edit it as needed for your data</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dr-JT/pupillometry">pupillometry</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/">here</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org">readr</a></span><span class="op">)</span>

<span class="va">import_dir</span> <span class="op">&lt;-</span> <span class="st">"folder/subfolder"</span>
<span class="va">output_dir</span> <span class="op">&lt;-</span> <span class="st">"folder/another_subfolder"</span>

<span class="va">files_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="va">import_dir</span><span class="op">)</span>, 
                         pattern <span class="op">=</span> <span class="st">".txt"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">file</span> <span class="kw">in</span> <span class="va">files_list</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">data_pupil</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pupil_read.html">pupil_read</a></span><span class="op">(</span><span class="va">file</span>, eyetracker <span class="op">=</span> <span class="st">"smi"</span>, eye_use <span class="op">=</span> <span class="st">"left"</span>,
                             subj_prefix <span class="op">=</span> <span class="st">"flanker"</span>, subj_suffix <span class="op">=</span> <span class="st">"a"</span>,
                             include_col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"RT"</span>, <span class="st">"accuracy"</span>, <span class="st">"condition"</span><span class="op">)</span>,
                             start_tracking_message <span class="op">=</span> <span class="st">"Fixation"</span>,
                             quality_check_dir <span class="op">=</span> <span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="va">output_dir</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
        <span class="fu"><a href="../reference/set_timing.html">set_timing</a></span><span class="op">(</span>onset_message <span class="op">=</span> <span class="st">"Stimulus_Onset"</span><span class="op">)</span> <span class="op">%&gt;%</span>
        <span class="fu"><a href="../reference/pupil_deblink.html">pupil_deblink</a></span><span class="op">(</span>extend <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="op">%&gt;%</span>
        <span class="fu"><a href="../reference/pupil_artifact.html">pupil_artifact</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">16</span><span class="op">)</span> <span class="op">%&gt;%</span>
        <span class="fu"><a href="../reference/pupil_missing.html">pupil_missing</a></span><span class="op">(</span>missing_allowed <span class="op">=</span> <span class="fl">.75</span><span class="op">)</span> <span class="op">%&gt;%</span>
        <span class="fu"><a href="../reference/pupil_upsample.html">pupil_upsample</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
        <span class="fu"><a href="../reference/pupil_smooth.html">pupil_smooth</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"mwa"</span>, n <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="op">%&gt;%</span>
        <span class="fu"><a href="../reference/pupil_interpolate.html">pupil_interpolate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"linear"</span>, maxgap <span class="op">=</span> <span class="fl">750</span>, hz <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span> <span class="op">%&gt;%</span>
        <span class="fu"><a href="../reference/pupil_baselinecorrect.html">pupil_baselinecorrect</a></span><span class="op">(</span>bc_onset_message <span class="op">=</span> <span class="st">"Stimulus_Onset"</span>,
                              baseline_duration <span class="op">=</span> <span class="fl">200</span><span class="op">)</span> <span class="op">%&gt;%</span>
        <span class="fu"><a href="../reference/pupil_artifact.html">pupil_artifact</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">16</span><span class="op">)</span> <span class="op">%&gt;%</span>
        <span class="fu"><a href="../reference/pupil_missing.html">pupil_missing</a></span><span class="op">(</span>missing_allowed <span class="op">=</span> <span class="fl">.25</span><span class="op">)</span> <span class="op">%&gt;%</span>
        <span class="fu"><a href="../reference/pupil_bin.html">pupil_bin</a></span><span class="op">(</span>bin_length <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>
    
    <span class="va">subj</span> <span class="op">&lt;-</span> <span class="va">data_pupil</span><span class="op">$</span><span class="va">Subject</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>
    <span class="va">output_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Flanker_PupilData_"</span>, <span class="va">subj</span>, 
                         <span class="st">"_deblink.artifact.smooth.interpolate.bc.csv"</span>,
                         sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
    
    <span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span><span class="va">data_pupil</span>, <span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="va">output_dir</span>, <span class="va">output_file</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="../reference/pupil_merge.html">pupil_merge</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="va">output_dir</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"bc.csv"</span>,
            ouptut_file <span class="op">=</span> <span class="st">"Flanker_PupilData_deblink.artifact.smooth.interpolate.bc.csv"</span><span class="op">)</span></code></pre></div>
<div id="references" class="section level2">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<p>Geller, J., Winn, M. B., Mahr, T., &amp; Mirman, D. (2020). GazeR: A Package for Processing Gaze Position and Pupil Size Data. Behavior Research Methods, 52(5), 2232–2255. <a href="https://doi.org/10.3758/s13428-020-01374-8" class="uri">https://doi.org/10.3758/s13428-020-01374-8</a></p>
<p>Kret, M. E., &amp; Sjak-Shie, E. E. (2019). Preprocessing pupil size data: Guidelines and code. Behavior Research Methods, 51(3), 1336–1342. <a href="https://doi.org/10.3758/s13428-018-1075-y" class="uri">https://doi.org/10.3758/s13428-018-1075-y</a></p>
<p>Mathôt, S., Fabius, J., Van Heusden, E., &amp; Van der Stigchel, S. (2018). Safe and sensible preprocessing and baseline correction of pupil-size data. Behavior Research Methods, 50(1), 94–106. <a href="https://doi.org/10.3758/s13428-017-1007-2" class="uri">https://doi.org/10.3758/s13428-017-1007-2</a></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="http://englelab.gatech.edu/jason">Jason Tsukahara</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: 'API_KEY',
    indexName: 'INDEX_NAME',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
