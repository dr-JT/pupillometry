<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Preprocessing • pupillometry</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Preprocessing">
<meta property="og:description" content="pupillometry">
<meta property="og:image" content="https://dr-jt.github.io/pupillometry/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pupillometry</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.7.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/preprocess_overview.html">Preprocessing Code (Template)</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Detailed Articles</li>
    <li>
      <a href="../articles/setup_pupil.html">Import and Setup</a>
    </li>
    <li>
      <a href="../articles/import_pupil.html">Import Options</a>
    </li>
    <li>
      <a href="../articles/remove_unlikely.html">Remove Unlikely Values</a>
    </li>
    <li>
      <a href="../articles/preprocess_pupil.html">Preprocessing</a>
    </li>
    <li>
      <a href="../articles/preprocessing_options.html">Preprocessing Options</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/dr-JT/pupillometry/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="preprocess_pupil_files/header-attrs-2.8/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Preprocessing</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dr-JT/pupillometry/blob/master/vignettes/preprocess_pupil.Rmd"><code>vignettes/preprocess_pupil.Rmd</code></a></small>
      <div class="hidden name"><code>preprocess_pupil.Rmd</code></div>

    </div>

    
    
<p>Preprocessing of the pupil data can involve up to 4 steps:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Up-Sample</strong> pupil data to 1000Hz. <code><a href="../reference/pupil_upsample.html">pupil_upsample()</a></code></p></li>
<li><p><strong>Smooth</strong> pupil data. <code><a href="../reference/pupil_smooth.html">pupil_smooth()</a></code></p></li>
<li><p><strong>Interpolate</strong> pupil data. <code><a href="../reference/pupil_interpolate.html">pupil_interpolate()</a></code></p></li>
<li><p><strong>Baseline Correct</strong> pupil data. <code><a href="../reference/pupil_baselinecorrect.html">pupil_baselinecorrect()</a></code></p></li>
</ol>
<div id="up-sample-pupil-data-to-1000hz" class="section level2">
<h2 class="hasAnchor">
<a href="#up-sample-pupil-data-to-1000hz" class="anchor"></a>1. Up-Sample pupil data to 1000Hz</h2>
<p>This is a fairly non-standard preprocessing step advised by Kret and Sjak-Shie (2019).</p>
<p>Up-sampling the data to 1000Hz has some advantages, namely that it makes working with timeseries data a bit easier because you are guaranteed one sample every 1 millisecond. When eye trackers record at a certain frequency, it is not uncommon for data recording to actually fluctuate around that value. For instance, if an eye tracker is sampling at 250Hz there should be exactly one sample every 4 milliseconds. However, it may occasionally skip a cycle and sample at every 5, 6, 7, 8… milliseconds. This can create inconsistent time values between trials in the data (e.g., Trial 1 may have pupil values at 0, 4, 9, and 13 milliseconds relative to stimulus onset but Trial 2 may have pupil values at 0, 5, 10, and 4 milliseconds).</p>
<p>Up-sampling can also increase the temporal resolution and smoothness of the data.</p>
<p>The data can be up-sampled to 1000Hz using <code><a href="../reference/pupil_upsample.html">pupil_upsample()</a></code>. Note that this function will simply create the additional rows in the data frame (e.g., original rows: 0, 4, 8… up-sampled rows: 0, 1, 2, 3, 4, 5, 6, 7, 8), and set pupil values for the added rows to missing.</p>
<p>The data can later be filled in when interpolation is performed.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/pupil_upsample.html">pupil_upsample</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>No arguments need to be specified.</p>
</div>
<div id="smooth-the-pupil-data" class="section level2">
<h2 class="hasAnchor">
<a href="#smooth-the-pupil-data" class="anchor"></a>2. Smooth the pupil data</h2>
<p>Many eye trackers will produce high-frequency signals in the data that are caused by noise in the eye tracker rather than any meaningful signal. It is advisable to reduce this noise as much as possible without reducing the meaningful signal in the data. This process is referred to as <strong>smoothing</strong> or <strong>low-pass filtering</strong>.</p>
<p>There are a ton of options for smoothing noisy data. The function <code><a href="../reference/pupil_smooth.html">pupil_smooth()</a></code> supports to common ways that have been applied to pupil data.</p>
<ul>
<li><p>Moving window average (mwa)</p></li>
<li><p>hanning filter (hann)</p></li>
</ul>
<p>Both of these methods reduce high-frequency fluctuations in the data and create smoother pupil wave-forms. These can be specified with the <code>type =</code> argument.</p>
<p>The degree to which high-frequency fluctuations are reduced in the data depends on the <strong>window</strong> size of the functions. The window size can be specified with the <code>n =</code> argument.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/pupil_smooth.html">pupil_smooth</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"mwa"</span>, n <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></code></pre></div>
<p>You do not want to specify too small of a window size (otherwise you really are not doing any smoothing at all) but certainly not too large of a window size (otherwise you will reduce meaningful signal in the data).</p>
<p>It can be extremely difficult to know what is the ideal window size for your data. You can use the <code>plot</code> and <code>plot_trial</code> arguments to determine what value to set the window size (n) to.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/pupil_smooth.html">pupil_smooth</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"mwa"</span>, n <span class="op">=</span> <span class="fl">100</span>, plot <span class="op">=</span> <span class="cn">TRUE</span>, plot_trial <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>To plot all trials use <code>plot_trial = "all"</code></p>
</div>
<div id="interpolate-the-pupil-data" class="section level2">
<h2 class="hasAnchor">
<a href="#interpolate-the-pupil-data" class="anchor"></a>3. Interpolate the pupil data</h2>
<p>It is recommended to smooth the data before interpolation.</p>
<p>You will likely have periods of missing pupil data due to blinks, looking away from the screen, etc. If you want to recover the pupil wave-form it is important to interpolate over those missing values.</p>
<p>Two common interpolation methods that have been used on pupil data are:</p>
<ul>
<li><p>linear</p></li>
<li><p>cubic-spline</p></li>
</ul>
<p>These can be performed with <code><a href="../reference/pupil_interpolate.html">pupil_interpolate()</a></code></p>
<p>Linear interpolation is the safest to go with as it basically draws a straight line from one of the missing data to the other end. However, such a straight line is probably not representing the true pupil wave-form. If all you want to do is aggregate pupil size over a period of data (such as in calculating pupil dilation), then linear interpolation is adequate.</p>
<p>However, if you want to perform growth curve analysis to model the actual timeseries pupil data you would like to recover the actual pupil wave-form underlying those missing values. Cubic-spline will attempt to recover a more realistic pupil wave-form. However, it can produce some weird and unlikely pupil wave-forms.</p>
<p>The type of interpolation to use can be specified in the <code>type =</code> argument.</p>
<p>You may not want to interpolate over large <strong>gaps</strong> of missing data. You can set the maximum gap in which to interpolate over with the <code>maxgap =</code> argument. If you do this you also need to supply the frequency (Hz) of the pupil data.</p>
<p><em>note if the pupil data were up-sampled with <code><a href="../reference/pupil_upsample.html">pupil_upsample()</a></code>, then Hz = 1000</em>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/pupil_interpolate.html">pupil_interpolate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"linear"</span>, maxgap <span class="op">=</span> <span class="fl">750</span>, hz <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/pupil_interpolate.html">pupil_interpolate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"cubic-spline"</span>, maxgap <span class="op">=</span> <span class="fl">750</span>, hz <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></code></pre></div>
<p>You can use the <code>plot</code> and <code>plot_trial</code> arguments to determine what type of interpolation to use.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/pupil_interpolate.html">pupil_interpolate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"cubic"</span>, maxgap <span class="op">=</span> <span class="fl">750</span>, hz <span class="op">=</span> <span class="fl">1000</span>, 
                  plot <span class="op">=</span> <span class="cn">TRUE</span>, plot_trial <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>To plot all trials use <code>plot_trial = "all"</code></p>
</div>
<div id="baseline-correct" class="section level2">
<h2 class="hasAnchor">
<a href="#baseline-correct" class="anchor"></a>4. Baseline correct</h2>
<p>If you are looking at changes in pupil size (e.g., pupil dilation) then you need to apply a baseline correction on the pupil data. This allows a more standard comparison across conditions and subjects (Mathôt et al., 2018)</p>
<p>You can perform baseline correction with <code><a href="../reference/pupil_baselinecorrect.html">pupil_baselinecorrect()</a></code>.</p>
<p>The procedure to baseline correct involves calculating a median pupil size value during some baseline period, typically a pre-trial or inter-stimulus interval period immediately before the onset of the critical period in which you want to calculate pupil dilation.</p>
<p>The main two arguments you need to specify are:</p>
<ul>
<li><p><strong>bc_onset_message</strong>: this is the <strong>message</strong> string in the data that indicates the <strong>onset</strong> of the critical period that you want to apply baseline correction (<strong>bc</strong>) on. It is likely going to be the same as the <code>onset_message =</code> argument in <code><a href="../reference/set_timing.html">set_timing()</a></code>, though not always.</p></li>
<li><p><strong>baseline_duration</strong>: this is the duration, in milliseconds, immediately preceding bc_onset_message to use when calculating the median pupil size value for the baseline period.</p></li>
</ul>
<p>You can also specify what type of baseline correction to perform:</p>
<ul>
<li>
<strong>type</strong>: “subtractive” or “divisive”. The default selection is “subtractive”.</li>
</ul>
<p>You may also need to specify that the message string in bc_onset_message is a “pattern” match instead of an “exact” match.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/pupil_baselinecorrect.html">pupil_baselinecorrect</a></span><span class="op">(</span>bc_onset_message <span class="op">=</span> <span class="st">"Stimulus_Onset"</span>, match <span class="op">=</span> <span class="st">"exact"</span>,
                      baselin_duration <span class="op">=</span> <span class="fl">200</span>,
                      type <span class="op">=</span> <span class="st">"subtractive"</span><span class="op">)</span></code></pre></div>
<p>You can then, perform some additional data cleaning by performing artifact rejection with <code><a href="../reference/pupil_artifact.html">pupil_artifact()</a></code> and remove trials with too much missing data <code><a href="../reference/pupil_missing.html">pupil_missing()</a></code>.</p>
</div>
<div id="references" class="section level2">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<p>Kret, M. E., &amp; Sjak-Shie, E. E. (2019). Preprocessing pupil size data: Guidelines and code. Behavior Research Methods, 51(3), 1336–1342. <a href="https://doi.org/10.3758/s13428-018-1075-y" class="uri">https://doi.org/10.3758/s13428-018-1075-y</a></p>
<p>Mathôt, S., Fabius, J., Van Heusden, E., &amp; Van der Stigchel, S. (2018). Safe and sensible preprocessing and baseline correction of pupil-size data. Behavior Research Methods, 50(1), 94–106. <a href="https://doi.org/10.3758/s13428-017-1007-2" class="uri">https://doi.org/10.3758/s13428-017-1007-2</a></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="http://englelab.gatech.edu/jason">Jason Tsukahara</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: 'API_KEY',
    indexName: 'INDEX_NAME',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
