<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Build Your Own Sequence of Pupillometry Functions • pupillometry</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Build Your Own Sequence of Pupillometry Functions">
<meta property="og:description" content="pupillometry">
<meta property="og:image" content="https://dr-jt.github.io/pupillometry/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pupillometry</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    <li class="dropdown-header">How To</li>
    <li>
      <a href="../articles/pupil_preprocess.html">How to Use pupil_preprocess()</a>
    </li>
    <li>
      <a href="../articles/pupillometry_functions.html">Build Your Own Sequence of Pupillometry Functions</a>
    </li>
    <li>
      <a href="../articles/message_markers.html">How to Use Message Markers</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Example Data Sets</li>
    <li>
      <a href="../articles/example_data.html">Example Data Set</a>
    </li>
    <li>
      <a href="../articles/example_data_w_out_messages.html">Example Data Set - What if My Data Doesn't Have Message Markers?</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">More Details</li>
    <li>
      <a href="../articles/preprocessing_options.html">Preprocessing Options</a>
    </li>
    <li>
      <a href="../articles/smooth_interpolate_first.html">Smooth or Interpolation First?</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/dr-JT/pupillometry/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Build Your Own Sequence of Pupillometry Functions</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dr-JT/pupillometry/blob/master/vignettes/pupillometry_functions.Rmd"><code>vignettes/pupillometry_functions.Rmd</code></a></small>
      <div class="hidden name"><code>pupillometry_functions.Rmd</code></div>

    </div>

    
    
<p>If you prefer not to use <code><a href="../reference/pupil_preprocess.html">pupil_preprocess()</a></code> then you can custom build your own sequence of preprocessing functions. I will provide an example on how to do so in this Article.</p>
<p>We will use the example data provided in the other Articles:</p>
<p>Download the <a href="http://englelab.gatech.edu/R/example_data/Example_Pitch.zip">Example Data Set</a> and run the script below</p>
<div id="pitch-discrimination-task" class="section level3">
<h3 class="hasAnchor">
<a href="#pitch-discrimination-task" class="anchor"></a>Pitch Discrimination Task</h3>
<p>Information about example data set:</p>
<ul>
<li><p>Raw Data Filename: “pitch_discrimination_19-1_001 Samples.txt”</p></li>
<li><p>Eyetracker: SMI Red250 Mobile recorded at 250 Hz</p></li>
<li><p>Contains message markers: Yes</p></li>
<li><p>Subject #: 19</p></li>
<li><p>Task: Pitch Discrimination</p></li>
<li><p>Trial Procedure: Fixation (Pre-trial - 3000 to 2000 ms) -&gt; Tone 1 (200 ms) -&gt; Inter-stimulus Interval (ISI - 500 ms) -&gt; Tone 2 (200 ms) -&gt; Response Screen (Until response)</p></li>
</ul>
<p><img src="../reference/figures/pitch_trialproc_w_markers.png" align="center"></p>
</div>
<div id="building-the-preprocessing-sequence" class="section level2">
<h2 class="hasAnchor">
<a href="#building-the-preprocessing-sequence" class="anchor"></a>Building the preprocessing sequence</h2>
<p>Let’s start off with building a sequence of preprocessing functions. For the first example, we will include all of the preprocessing steps that are used in <code><a href="../reference/pupil_preprocess.html">pupil_preprocess()</a></code>.</p>
<hr>
<p>The overall workflow of <code><a href="../reference/pupil_preprocess.html">pupil_preprocess()</a></code> is:</p>
<ol style="list-style-type: decimal">
<li>
<p><strong>Read</strong> in raw data files <code><a href="../reference/pupil_read.html">pupil_read()</a></code></p>
<ul>
<li>If <code>tracking.file</code> is supplied will also add message markers to the data</li>
</ul>
</li>
<li>
<p>Clean up raw data files and more</p>
<ul>
<li><p><strong>Correlate</strong> left and right pupil size (if both eyes were recorded from). <code><a href="../reference/pupil_cor.html">pupil_cor()</a></code></p></li>
<li><p><strong>Select</strong> either left or right pupil data (if both eyes were recorded from). <code><a href="../reference/select_eye.html">select_eye()</a></code></p></li>
<li><p>Set <strong>Timing</strong> variable to be relative to onset of each trial. <code><a href="../reference/set_timing.html">set_timing()</a></code></p></li>
<li><p>Set <strong>Stimulus</strong> variable from <strong>Message Markers</strong>. <code><a href="../reference/set_stimuli.html">set_stimuli()</a></code></p></li>
</ul>
</li>
<li><p><strong>De-blink</strong> data. <code><a href="../reference/pupil_deblink.html">pupil_deblink()</a></code></p></li>
<li><p><strong>Smooth</strong> (if specified). <code><a href="../reference/pupil_smooth.html">pupil_smooth()</a></code></p></li>
<li><p><strong>Interpolate</strong> (if specified). <code><a href="../reference/pupil_interpolate.html">pupil_interpolate()</a></code></p></li>
<li><p><strong>Baseline Correct</strong> (if specified). <code><a href="../reference/pupil_baselinecorrect.html">pupil_baselinecorrect()</a></code></p></li>
<li><p>Remove trials with too much <strong>Missing Data</strong>. <code><a href="../reference/pupil_missing.html">pupil_missing()</a></code></p></li>
</ol>
<hr>
<p>Let’s go over these steps one by one.</p>
<div id="read-in-raw-files" class="section level3">
<h3 class="hasAnchor">
<a href="#read-in-raw-files" class="anchor"></a>1. Read in raw files</h3>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="no">data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/pupil_read.html">pupil_read</a></span>(<span class="kw">file</span> <span class="kw">=</span> <span class="st">"data/raw/pitch_discrimination_19-1_001 Samples.txt"</span>,
                   <span class="kw">eyetracker</span> <span class="kw">=</span> <span class="st">"smi"</span>,
                   <span class="kw">start_tracking.message</span> <span class="kw">=</span> <span class="st">"default"</span>,
                   <span class="kw">start_tracking.match</span> <span class="kw">=</span> <span class="st">"exact"</span>,
                   <span class="kw">subj.prefix</span> <span class="kw">=</span> <span class="st">"n_"</span>, <span class="kw">subj.suffix</span> <span class="kw">=</span> <span class="st">"-"</span>, <span class="kw">timing.file</span> <span class="kw">=</span> <span class="kw">NULL</span>,
                   <span class="kw">subset</span> <span class="kw">=</span> <span class="st">"default"</span>, <span class="kw">trial.exclude</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>())</pre></body></html></div>
<p>Since we are using most of the default parameter arguments we can shorten it to</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/pupil_read.html">pupil_read</a></span>(<span class="kw">file</span> <span class="kw">=</span> <span class="st">"data/raw/pitch_discrimination_19-1_001 Samples.txt"</span>,
                   <span class="kw">eyetracker</span> <span class="kw">=</span> <span class="st">"smi"</span>, <span class="kw">subj.prefix</span> <span class="kw">=</span> <span class="st">"n_"</span>, <span class="kw">subj.suffix</span> <span class="kw">=</span> <span class="st">"-"</span>)</pre></body></html></div>
</div>
<div id="clean-up-raw-data-files-and-more" class="section level3">
<h3 class="hasAnchor">
<a href="#clean-up-raw-data-files-and-more" class="anchor"></a>2. Clean up raw data files and more</h3>
<p>Because we have data from both left and right eyes we can calculate the correlation between the two eyes with <code><a href="../reference/pupil_cor.html">pupil_cor()</a></code>. After calculating the correlation, we only want to keep one of the eyes for analysis; <code><a href="../reference/select_eye.html">select_eye()</a></code>.</p>
<p>The values in the Timing column are usually in absolute time from the start of recording. However, data analysis is much easier if the values are in relative time from the start of each Trial. So at every trial onset, Time = 0. We can do this with <code><a href="../reference/set_timing.html">set_timing()</a></code>.</p>
<p>Data analysis is also easier if instead of relying on message markers (values only at onset or offset of an event), there was a column that had a value for every sample (row) in the data corresponding to what part of the trial that sample is in (e.g. Cue, Target, Fixation, Response, etc.). The function <code><a href="../reference/set_stimuli.html">set_stimuli()</a></code> uses the message markers to do so.</p>
<p>Putting all these steps together would look like</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">data</span> <span class="kw">&lt;-</span> <span class="no">data</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/pupil_cor.html">pupil_cor</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/select_eye.html">select_eye</a></span>(<span class="kw">eye.use</span> <span class="kw">=</span> <span class="st">"left"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/set_timing.html">set_timing</a></span>(<span class="kw">trial_onset.message</span> <span class="kw">=</span> <span class="st">"Tone 1"</span>, <span class="kw">match</span> <span class="kw">=</span> <span class="st">"exact"</span>,
             <span class="kw">ms.conversion</span> <span class="kw">=</span> <span class="fl">1000</span>, <span class="kw">pre_trial.duration</span> <span class="kw">=</span> <span class="fl">1000</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/set_stimuli.html">set_stimuli</a></span>()</pre></body></html></div>
</div>
<div id="de-blink" class="section level3">
<h3 class="hasAnchor">
<a href="#de-blink" class="anchor"></a>3. De-blink</h3>
<p>It is important to make sure that blinks are coded as having missing values, and you may even want to extend the de-blink duration depending on which eyetracker you are using (this is suggested when using EyeLink eyetrackers)</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/pupil_deblink.html">pupil_deblink</a></span>(<span class="no">data</span>, <span class="kw">extend</span> <span class="kw">=</span> <span class="fl">100</span>)</pre></body></html></div>
</div>
<div id="smooth" class="section level3">
<h3 class="hasAnchor">
<a href="#smooth" class="anchor"></a>4. Smooth</h3>
<p>You need to be careful about the window size you specify for smoothing. Window size is specified in milliseconds rather than number of samples. Therefore, you should think carefully about what your recording frequency is when specifying the window size.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/pupil_smooth.html">pupil_smooth</a></span>(<span class="no">data</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"hann"</span>, <span class="kw">window</span> <span class="kw">=</span> <span class="fl">500</span>, <span class="kw">hz</span> <span class="kw">=</span> <span class="fl">250</span>)</pre></body></html></div>
</div>
<div id="interpolate" class="section level3">
<h3 class="hasAnchor">
<a href="#interpolate" class="anchor"></a>5. Interpolate</h3>
<p>You may want to consider setting a maximum gap of missing values that you are comfortable interpolating over. For instance, if a subject has a gap of missing data that covers the entire critical period where you are looking for an effect, then it might be a good idea to make sure data is not interpolated over gaps larger than the critical task period.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/pupil_interpolate.html">pupil_interpolate</a></span>(<span class="no">data</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"cubic-spline"</span>, <span class="kw">maxgap</span> <span class="kw">=</span> <span class="fl">750</span>, <span class="kw">hz</span> <span class="kw">=</span> <span class="fl">250</span>)</pre></body></html></div>
</div>
<div id="baseline-correction" class="section level3">
<h3 class="hasAnchor">
<a href="#baseline-correction" class="anchor"></a>6. Baseline correction</h3>
<p>This function will create a new column of baseline corrected data called <code>Pupil_Diameter_bc.mm</code></p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/pupil_baselinecorrect.html">pupil_baselinecorrect</a></span>(<span class="no">data</span>, <span class="kw">message</span> <span class="kw">=</span> <span class="st">"Tone 1"</span>, <span class="kw">match</span> <span class="kw">=</span> <span class="st">"exact"</span>,
                              <span class="kw">pre.duration</span> <span class="kw">=</span> <span class="fl">200</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"subtractive"</span>)</pre></body></html></div>
</div>
<div id="remove-trials-with-too-much-missing-data" class="section level3">
<h3 class="hasAnchor">
<a href="#remove-trials-with-too-much-missing-data" class="anchor"></a>7. Remove trials with too much missing data</h3>
<p>Finally, it can be a good idea to go ahead and remove any trials that have too much missing data even after these preprocessing methods. You can set the criteria of what is too much missing data</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/pupil_missing.html">pupil_missing</a></span>(<span class="no">data</span>, <span class="kw">missing.allowed</span> <span class="kw">=</span> <span class="fl">.33</span>)</pre></body></html></div>
<hr>
<p>Putting it all together, we get:</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/pupil_read.html">pupil_read</a></span>(<span class="kw">file</span> <span class="kw">=</span> <span class="st">"data/raw/pitch_discrimination_19-1_001 Samples.txt"</span>,
                   <span class="kw">eyetracker</span> <span class="kw">=</span> <span class="st">"smi"</span>, <span class="kw">subj.prefix</span> <span class="kw">=</span> <span class="st">"n_"</span>, <span class="kw">subj.suffix</span> <span class="kw">=</span> <span class="st">"-"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/pupil_cor.html">pupil_cor</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/select_eye.html">select_eye</a></span>(<span class="kw">eye.use</span> <span class="kw">=</span> <span class="st">"left"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/set_timing.html">set_timing</a></span>(<span class="kw">trial_onset.message</span> <span class="kw">=</span> <span class="st">"Tone 1"</span>, <span class="kw">match</span> <span class="kw">=</span> <span class="st">"exact"</span>,
             <span class="kw">ms.conversion</span> <span class="kw">=</span> <span class="fl">1000</span>, <span class="kw">pre_trial.duration</span> <span class="kw">=</span> <span class="fl">1000</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/set_stimuli.html">set_stimuli</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/pupil_deblink.html">pupil_deblink</a></span>(<span class="kw">extend</span> <span class="kw">=</span> <span class="fl">100</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/pupil_smooth.html">pupil_smooth</a></span>(<span class="kw">type</span> <span class="kw">=</span> <span class="st">"hann"</span>, <span class="kw">window</span> <span class="kw">=</span> <span class="fl">500</span>, <span class="kw">hz</span> <span class="kw">=</span> <span class="fl">250</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/pupil_interpolate.html">pupil_interpolate</a></span>(<span class="kw">type</span> <span class="kw">=</span> <span class="st">"cubic-spline"</span>, <span class="kw">maxgap</span> <span class="kw">=</span> <span class="fl">750</span>, <span class="kw">hz</span> <span class="kw">=</span> <span class="fl">250</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/pupil_baselinecorrect.html">pupil_baselinecorrect</a></span>(<span class="kw">message</span> <span class="kw">=</span> <span class="st">"Tone 1"</span>, <span class="kw">match</span> <span class="kw">=</span> <span class="st">"exact"</span>,
                        <span class="kw">pre.duration</span> <span class="kw">=</span> <span class="fl">200</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"subtractive"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/pupil_missing.html">pupil_missing</a></span>(<span class="kw">missing.allowed</span> <span class="kw">=</span> <span class="fl">.33</span>)</pre></body></html></div>
<hr>
<p>In this way you can build your own sequence of preprocessing steps. To leave out a preprocessing method, just leave out the function.</p>
</div>
</div>
<div id="doing-this-for-multiple-files" class="section level2">
<h2 class="hasAnchor">
<a href="#doing-this-for-multiple-files" class="anchor"></a>Doing this for multiple files</h2>
<p>The chunk of code was adequate for performing preprocessing data from one file. To perform this same process for each of your subject data files you just need to put it in a <strong>for loop</strong>.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">pupillometry</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">readr</span>)

<span class="no">filelist</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span>(<span class="kw">path</span> <span class="kw">=</span> <span class="st">"data/raw"</span>, <span class="kw">pattern</span> <span class="kw">=</span> <span class="st">".txt"</span>, <span class="kw">full.names</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="kw">for</span> (<span class="no">file</span> <span class="kw">in</span> <span class="no">filelist</span>) {
  <span class="no">data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/pupil_read.html">pupil_read</a></span>(<span class="kw">file</span> <span class="kw">=</span> <span class="no">file</span>, <span class="kw">eyetracker</span> <span class="kw">=</span> <span class="st">"smi"</span>,
                     <span class="kw">subj.prefix</span> <span class="kw">=</span> <span class="st">"n_"</span>, <span class="kw">subj.suffix</span> <span class="kw">=</span> <span class="st">"-"</span>) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="../reference/pupil_cor.html">pupil_cor</a></span>() <span class="kw">%&gt;%</span>
    <span class="fu"><a href="../reference/select_eye.html">select_eye</a></span>(<span class="kw">eye.use</span> <span class="kw">=</span> <span class="st">"left"</span>) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="../reference/set_timing.html">set_timing</a></span>(<span class="kw">trial_onset.message</span> <span class="kw">=</span> <span class="st">"Tone 1"</span>, <span class="kw">match</span> <span class="kw">=</span> <span class="st">"exact"</span>,
               <span class="kw">ms.conversion</span> <span class="kw">=</span> <span class="fl">1000</span>, <span class="kw">pre_trial.duration</span> <span class="kw">=</span> <span class="fl">1000</span>) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="../reference/set_stimuli.html">set_stimuli</a></span>() <span class="kw">%&gt;%</span>
    <span class="fu"><a href="../reference/pupil_deblink.html">pupil_deblink</a></span>(<span class="kw">extend</span> <span class="kw">=</span> <span class="fl">100</span>) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="../reference/pupil_smooth.html">pupil_smooth</a></span>(<span class="kw">type</span> <span class="kw">=</span> <span class="st">"hann"</span>, <span class="kw">window</span> <span class="kw">=</span> <span class="fl">500</span>, <span class="kw">hz</span> <span class="kw">=</span> <span class="fl">250</span>) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="../reference/pupil_interpolate.html">pupil_interpolate</a></span>(<span class="kw">type</span> <span class="kw">=</span> <span class="st">"cubic-spline"</span>, <span class="kw">maxgap</span> <span class="kw">=</span> <span class="fl">750</span>, <span class="kw">hz</span> <span class="kw">=</span> <span class="fl">250</span>) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="../reference/pupil_baselinecorrect.html">pupil_baselinecorrect</a></span>(<span class="kw">message</span> <span class="kw">=</span> <span class="st">"Tone 1"</span>, <span class="kw">match</span> <span class="kw">=</span> <span class="st">"exact"</span>,
                          <span class="kw">pre.duration</span> <span class="kw">=</span> <span class="fl">200</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"subtractive"</span>) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="../reference/pupil_missing.html">pupil_missing</a></span>(<span class="kw">missing.allowed</span> <span class="kw">=</span> <span class="fl">.33</span>)

  <span class="no">subj</span> <span class="kw">&lt;-</span> <span class="no">data</span>$<span class="no">Subject</span>[<span class="fl">1</span>]
  <span class="no">SaveAs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"data/preprocessed/PitchDiscrimination_"</span>, <span class="no">subj</span>,
                  <span class="st">"_PupilData_smoothed.interpolated.bc.csv"</span>, <span class="kw">sep</span> <span class="kw">=</span> <span class="st">""</span>)
  <span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span>(<span class="no">data</span>, <span class="no">SaveAs</span>)
}</pre></body></html></div>
<p>If you want to then create a single merged file you can add at the end (outside of the for loop):</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu"><a href="../reference/pupil_merge.html">pupil_merge</a></span>(<span class="kw">path</span> <span class="kw">=</span> <span class="st">"data"</span>,
            <span class="kw">pattern</span> <span class="kw">=</span> <span class="st">"bc.csv"</span>,
            <span class="kw">output.file</span> <span class="kw">=</span> <span class="st">"PitchDiscrimination_PupilData.csv"</span>)</pre></body></html></div>
<p>However, this may not be possible depending on your sample frequency (hz) and number of participants. This is because it may exceed the storage limits of R and possibly your computer.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="http://englelab.gatech.edu/jason">Jason Tsukahara</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.0.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: 'API_KEY',
    indexName: 'INDEX_NAME',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
